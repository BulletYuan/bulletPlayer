"use strict";function bulletPlayer(e){var t=this,n=null,r=null,o=null,i=null,l=0,u=0,a=1,c="",s=1,d=!0,f=!1,h=1e3/30,y="",m=0,p=0,b=0,S=0,g=0,L=!1,w=!1,B=0,C=0,P=null,q="",E="",V="",x="",T="",I="",W="",H="",_="",M="",U="",k="",F="";e&&0===JSON.stringify(e).indexOf("{")||(e={}),y=e.title||y,d=e.debug||d,f=e.stream||f,h=e.fps||h,a=e.quality||a,s=e.volume||s,c=e.src||c;var X={htmlObj:[{el:"div",attr:{class:["playerContainer-bullet"],"data-bulletPlayer":["data-bulletPlayer"]},child:[{el:"div",attr:{class:["titleBar"]},child:[{el:"p",attr:{class:["titleText"]},text:y}]},{el:"canvas"},{el:"div",attr:{class:["controlBar"]},child:[{el:"div",attr:{class:["progressBar"]},child:[{el:"div",attr:{class:["buffBar"]}},{el:"div",attr:{class:["playedBar"]}},{el:"div",attr:{class:["handle"]}}]},{el:"div",attr:{class:["toolBar"]},child:[{el:"div",attr:{class:["leftBar"]},child:[{el:"div",attr:{class:["playBtn"]},text:"play"},{el:"div",attr:{class:["duration"]},text:"00:00:00 / 00:00:00"}]},{el:"div",attr:{class:["rightBar"]},child:[{el:"div",attr:{class:["fullScreenBtn"]},text:"fullScreen"},{el:"div",attr:{class:["volumeBar"]},child:[{el:"span",attr:{class:["volumeNum"]},text:"0"},{el:"p",attr:{class:["volume"]},child:[{el:"span",attr:{class:["volumeHandler"]}},{el:"span",attr:{class:["volumeValue"]}}]}]}]}]}]},{el:"div",attr:{class:["playedCon"]},child:[{el:"div",attr:{class:["playBtn"]},text:"play"}]}]}],createDom:function(e){if(!e)return!1;var t=document.createElement(e.el);return e.attr&&Object.keys(e.attr).length>0&&Object.keys(e.attr).forEach(function(n){e.attr[n]&&e.attr[n].length>0&&t.setAttribute(n,e.attr[n].join(" "))}),e.text&&""!=e.text&&(t.innerHTML=e.text),e.child&&e.child.length>0&&e.child.forEach(function(e){t.appendChild(X.createDom(e))}),U&&U(),t}},A={initSize:function(){if(!i||!o||!r)return!1;a=Math.abs(a)>1?1:Math.abs(a);var e=0,t=i.videoWidth,n=i.videoHeight;(!l||l<=0)&&(l=n>=o.clientHeight?o.clientHeight:n),e=t/n,u=l*e,r.height=l*a,r.width=u,r.style.width=r.clientHeight*e+"px"},initParams:function(){if(!i)return!1;clearInterval(P),P=null,setTimeout(function(){c=c||i.currentSrc,s=s||i.volume,L=L||i.autoPlay,w=w||i.loop,i.currentSrc=c,i.volume=Math.abs(s)>1?1:Math.abs(s),i.autoPlay=L,i.loop=w,i.controls=!1},0)},listenVideo:function(){i.addEventListener("loadstart",function(){j.console(0,"loadstart"),q&&q()},!1),i.addEventListener("durationchange",function(){j.console(0,"durationchange"),D.refreshUI_duration(),N.bindMouseListener(),z.hideControlBar(),z.hideTitleBar(),z.hideCursor(),E&&E()},!1),i.addEventListener("loadedmetadata",function(){j.console(0,"loadedmetadata"),V&&V()},!1),i.addEventListener("loadeddata",function(){j.console(0,"loadeddata"),A.initSize(),D.refreshParams(),D.refreshUI(),z.getVideoPoster(),x&&x()},!1),i.addEventListener("progress",function(){j.console(0,"progress"),D.refreshUI_buffBar(),T&&T()},!1),i.addEventListener("canplay",function(){j.console(0,"canplay"),z.hideLoading(),D.refreshParams(),D.refreshUI(),N.bindFullScreen(),N.bindVolumeChanged(),N.bindPlay(),N.bindPause(),N.bindEnded(),N.bindHandlerDrag(),I&&I()},!1)},resetParams:function(){S=0,b=0,m=0,p=b/S,B=v.networkState,L=!1,w=!1,document.webkitFullscreenEnabled||(g=-1),C=0,clearInterval(P),P=null}},D={refreshParams:function(){if(!i)return!1;var e=i;S=e.duration,b=e.currentTime,m=e.buffered.length>0?e.buffered.end(e.buffered.length-1)/S:0,p=b/S,B=e.networkState,L=e.autoplay,w=e.loop,document.webkitFullscreenEnabled||(g=-1),e.ended&&(C=0),e.played&&(C=1),e.paused&&(C=2),e.error&&(C=-1)},refreshUI:function(){if(!i||!o)return!1;var e=o.querySelector(".buffBar"),n=o.querySelector(".playedBar"),r=o.querySelector(".handle"),l=o.querySelector(".duration");t.getVolume(),D.refreshUI_duration(l),D.refreshUI_buffBar(e),D.refreshUI_playedBar(n,r),D.refreshUI_handle(r),F&&F()},refreshUI_canvas:function(){0!==C&&-1!==C||O._resetCav(),1===C&&O.refreshCav(),2===C&&O.stopCav(),D.refreshUI()},refreshUI_duration:function(e){return e&&(e.innerHTML=j.transformTime(b)+" / "+j.transformTime(S)),e},refreshUI_buffBar:function(e){return e&&(e.style.width=100*m+"%"),e},refreshUI_playedBar:function(e,t){return e&&t&&(e.style.width=(p*o.clientWidth-t.clientWidth/2<=0?0:p*o.clientWidth-t.clientWidth/2)+"px"),e},refreshUI_handle:function(e){return e&&(e.style.left=p*o.clientWidth-e.clientWidth/2+"px"),e}},N={bindFullScreen:function(){if(j.console(0,"bindFullScreen"),!o||!r)return!1;var e=o.querySelector(".fullScreenBtn");-1!=g&&e.addEventListener("click",function(){0===g?setTimeout(function(){t.enterFullScreen()},100):setTimeout(function(){t.exitFullScreen()},100)},!1)},bindVolumeChanged:function(){if(j.console(0,"bindVolumeChanged"),!o)return!1;var e=o.querySelector(".volume").clientWidth,t=o.querySelector(".volume"),n=o.querySelector(".volumeHandler"),r=o.querySelector(".volumeValue"),l=o.querySelector(".volumeNum"),u=2;window.ontouchstart?n.ontouchstart=function(o){u=0,document.ontouchmove=function(o){u=1,o.clientX-t.offsetParent.offsetLeft-t.offsetLeft>=n.clientWidth&&o.clientX-t.offsetParent.offsetLeft-t.offsetLeft<=e&&(n.style.left=o.clientX-t.offsetParent.offsetLeft-t.offsetLeft-n.clientWidth+"px",r.style.width=o.clientX-t.offsetParent.offsetLeft-t.offsetLeft-n.clientWidth/2+"px",l.innerHTML=Math.floor((Number(r.style.width.split("px")[0])-n.clientWidth/2)/(e-n.clientWidth)*100),i.volume=(Number(r.style.width.split("px")[0])-n.clientWidth/2)/(e-n.clientWidth))},document.ontouchend=function(){u=2,document.onmousemove=null,document.onmouseup=null}}:n.onmousedown=function(a){u=0,document.onmousemove=function(o){u=1,o.clientX-t.offsetParent.offsetLeft-t.offsetLeft>=n.clientWidth&&o.clientX-t.offsetParent.offsetLeft-t.offsetLeft<=e&&(n.style.left=o.clientX-t.offsetParent.offsetLeft-t.offsetLeft-n.clientWidth+"px",r.style.width=o.clientX-t.offsetParent.offsetLeft-t.offsetLeft-n.clientWidth/2+"px",l.innerHTML=Math.floor((Number(r.style.width.split("px")[0])-n.clientWidth/2)/(e-n.clientWidth)*100),i.volume=(Number(r.style.width.split("px")[0])-n.clientWidth/2)/(e-n.clientWidth))},o.onmouseleave=document.onmouseup=function(){u=2,document.onmousemove=null,document.onmouseup=null,o.onmouseleave=null}}},bindMouseListener:function(){if(j.console(0,"bindMouseListener"),!o)return!1;var e=0,t=0,n=null;o.addEventListener("mousemove",function(r){e=0,t=0,clearTimeout(n),n=null,z.showControlBar(),z.showTitleBar(),z.showCursor(),e=r.screenX,t=r.screenY,n=setTimeout(function(){0!==e&&0!==t&&e===r.screenX&&t===r.screenY?(z.hideControlBar(),z.hideTitleBar(),z.hideCursor()):(z.showControlBar(),z.showTitleBar(),z.showCursor()),e=0,t=0,clearTimeout(n),n=null},3e3)},!1),o.addEventListener("mouseleave",function(r){e=0,t=0,clearTimeout(n),n=null,z.hideControlBar(),z.hideTitleBar(),z.hideCursor()})},bindKeysListener:function(){if(j.console(0,"bindKeysListener"),!o)return!1;o.addEventListener("keypress",function(e){})},bindHandlerDrag:function(){if(j.console(0,"bindHandlerDrag"),!o)return!1;var e=o.querySelector(".handle"),n=2;window.ontouchstart?e.ontouchstart=function(r){n=0,document.ontouchmove=function(r){n=1,e.style.left=r.clientX-e.clientWidth/2+"px",i.currentTime=r.clientX/o.clientWidth*i.duration,i.paused||t.pauseVideo()},document.ontouchend=function(){n=2,document.onmousemove=null,document.onmouseup=null,t.playVideo()}}:e.onmousedown=function(r){n=0,document.onmousemove=function(r){n=1,e.style.left=r.clientX-e.clientWidth/2+"px",i.currentTime=r.clientX/o.clientWidth*i.duration,i.paused||t.pauseVideo()},document.onmouseup=function(){n=2,document.onmousemove=null,document.onmouseup=null,t.playVideo()}}},bindPlay:function(){if(j.console(0,"bindPlay"),!i||!o||!r)return!1;o.querySelectorAll(".playBtn").forEach(function(e){e.onclick=function(){0!==C&&2!==C||t.playVideo(),1===C&&t.pauseVideo()}}),o.querySelector(".playedCon").onclick=r.onclick=function(){0!==C&&2!==C||t.playVideo(),1===C&&t.pauseVideo()},i.addEventListener("play",function(){o.querySelector(".playedCon").style.display="none",o.querySelectorAll(".playBtn").forEach(function(e){e.innerHTML="pause"}),C=1,D.refreshUI_canvas(),H&&H()},!1)},bindPause:function(){if(j.console(0,"bindPause"),!i||!o)return!1;i.addEventListener("pause",function(){o.querySelector(".playedCon").style.display="block",o.querySelectorAll(".playBtn").forEach(function(e){e.innerHTML="play"}),clearInterval(P),P=null,C=2,D.refreshParams(),D.refreshUI(),_&&_()},!1)},bindEnded:function(){if(j.console(0,"bindEnded"),!i||!o)return!1;i.addEventListener("ended",function(){o.querySelector(".playedCon").style.display="block",o.querySelectorAll(".playBtn").forEach(function(e){e.innerHTML="play"}),clearInterval(P),P=null,C=1,z.getVideoPoster(),D.refreshParams(),D.refreshUI(),M&&M()},!1)}},z={showLoading:function(){o.querySelector(".playedCon").style.display="block",o.querySelectorAll(".playBtn").forEach(function(e){e.innerHTML="loading"})},hideLoading:function(){"block"==o.querySelector(".playedCon").style.display&&(o.querySelector(".playedCon").style.display="block"),o.querySelectorAll(".playBtn").forEach(function(e){e.innerHTML="play"})},showControlBar:function(){if(!o)return!1;o.querySelector(".controlBar").style.bottom="0px"},hideControlBar:function(){if(!o)return!1;o.querySelector(".controlBar").style.bottom="-"+(o.querySelector(".controlBar").clientHeight-o.querySelector(".progressBar").clientHeight)+"px"},showTitleBar:function(){if(!o)return!1;o.querySelector(".titleBar").style.top="0px"},hideTitleBar:function(){if(!o)return!1;o.querySelector(".titleBar").style.top="-"+o.querySelector(".titleBar").clientHeight+"px"},showCursor:function(){if(!o||!r)return!1;o.style.cursor="pointer",r.style.cursor="pointer"},hideCursor:function(){if(!o||!r)return!1;o.style.cursor="none",r.style.cursor="none"},getVideoPoster:function(){if(!i||!r||!n)return!1;0!=i.currentTime&&(i.currentTime=0),setTimeout(function(){O.drawCav()},0)}},O={refreshCav:function(){if(!n||!i||1!==C)return!1;clearInterval(P),P=null,P=setInterval(function(){O.drawCav(),D.refreshParams(),D.refreshUI()},h)},drawCav:function(){if(!n||!i)return!1;n.drawImage(i,0,0,u,l)},stopCav:function(){if(!n)return!1;O.drawCav(),clearInterval(P),P=null},resetCav:function(){if(!n)return!1;clearInterval(P),P=null}},j={transformTime:function(e){e&&"number"==typeof e||(e=0);var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=Math.floor(e-3600*t-60*n);return(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n)+":"+(r>=10?r:"0"+r)},console:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(d){for(var t,n,r,o=arguments.length,i=Array(o>1?o-1:0),l=1;l<o;l++)i[l-1]=arguments[l];0===e&&(t=console).log.apply(t,["bulletPlayer"].concat(i)),1===e&&(n=console).info.apply(n,["bulletPlayer"].concat(i)),2===e&&(r=console).error.apply(r,["bulletPlayer"].concat(i))}})},K=function(e,t){o=t,i=e,r=o.querySelector("canvas"),n=r.getContext("2d"),o.style=i.style,i.style.display="none",z.showLoading(),A.initParams(),z.showControlBar(),z.showTitleBar(),z.showCursor(),k&&k(),f?(N.bindMouseListener(),z.hideControlBar(),z.hideTitleBar(),z.hideCursor(),A.initSize(),z.hideLoading(),D.refreshParams(),D.refreshUI(),N.bindFullScreen(),N.bindVolumeChanged(),N.bindPlay(),N.bindPause(),N.bindEnded(),N.bindHandlerDrag()):A.listenVideo(),window.addEventListener("resize",function(){A.initSize(),D.refreshUI(),f||O.drawCav(),W&&W()},!1)};this.init=function(){return document.querySelectorAll("video[data-bulletPlayer]").length>0&&(document.querySelectorAll("video[data-bulletPlayer]").forEach(function(e){X.htmlObj.forEach(function(t){e.parentElement.insertBefore(X.createDom(t),e)})}),setTimeout(function(){var e=document.querySelectorAll("video[data-bulletPlayer]"),t=document.querySelectorAll(".playerContainer-bullet[data-bulletPlayer]");e.forEach(function(e,n){K(e,t[n])})},0),this)},f?(this.draw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!n||!e)return!1;try{n.drawImage(e,0,0,u,l),D.refreshParams(),D.refreshUI(),t&&t()}catch(e){j.console(2,"playVideo has error:\n"+e)}return this},this.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!n)return!1;try{r.height=l,e&&e()}catch(e){j.console(2,"playVideo has error:\n"+e)}return this}):(this.playVideo=function(){if(!i)return!1;try{i.play()}catch(e){j.console(2,"playVideo has error:\n"+e)}return this},this.pauseVideo=function(){if(!i)return!1;try{i.pause()}catch(e){j.console(2,"pauseVideo has error:\n"+e)}return this},this.onVideoLoadStart=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(q=e),this},this.onVideoDurationChange=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(E=e),this},this.onVideoLoadedMetaData=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(V=e),this},this.onVideoLoadedData=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(x=e),this},this.onVideoProgressData=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(T=e),this},this.onVideoCanPlay=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(I=e),this},this.onResize=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(W=e),this},this.onVideoPlay=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(H=e),this},this.onVideoPause=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(_=e),this},this.onVideoEnded=function(e){return e&&(void 0===e?"undefined":_typeof(e))&&(M=e),this}),this.getVolume=function(){if(!i||!o)return!1;s=i.volume;var e=o.querySelector(".volume").clientWidth,t=o.querySelector(".volumeHandler"),n=o.querySelector(".volumeValue"),r=o.querySelector(".volumeNum");return t.style.left=e*s-t.clientWidth+"px",n.style.width=e*s-t.clientWidth/2+"px",r.innerHTML=100*s,s},this.setVolume=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!i||!o)return!1;i.volume=e,s=e;var t=o.querySelector(".volume").clientWidth,n=o.querySelector(".volumeHandler"),r=o.querySelector(".volumeValue"),l=o.querySelector(".volumeNum");return n.style.left=t*s-n.clientWidth+"px",r.style.width=t*s-n.clientWidth/2+"px",l.innerHTML=100*s,s},this.exitFullScreen=function(){return!(!i||!o)&&(!!document.webkitFullscreenEnabled&&(g=0,o.style.height="600px",A.initSize(),D.refreshUI(),this))},this.enterFullScreen=function(){return!!i&&(!!document.webkitFullscreenEnabled&&(document.webkitCurrentFullScreenElement&&document.webkitCurrentFullScreenElement.forEach(function(e){e!=i&&e.webkitExitFullScreen()}),g=1,o.style.height=window.innerHeight+"px",A.initSize(),D.refreshUI(),this))},this.onCreate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&(void 0===e?"undefined":_typeof(e))&&(U=e),this},this.onInit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&(void 0===e?"undefined":_typeof(e))&&(k=e),this},this.onRefresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&(void 0===e?"undefined":_typeof(e))&&(F=e),this}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};